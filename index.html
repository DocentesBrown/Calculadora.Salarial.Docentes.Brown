<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Salarial Docente</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --azul-oscuro: #24496e;
      --morado: #4d3069;
      --celeste: #3d8fb0;
      --beige: #f3efdc;
      --rojo: #da6863;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--beige);
      color: var(--azul-oscuro);
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: var(--morado);
      font-size: 2em;
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: var(--azul-oscuro);
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border: 1px solid var(--celeste);
      border-radius: 8px;
      font-size: 1em;
      background-color: white;
      transition: border-color 0.3s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--morado);
    }

    button {
      background-color: var(--morado);
      color: white;
      padding: 14px;
      border: none;
      border-radius: 8px;
      margin-top: 25px;
      cursor: pointer;
      width: 100%;
      font-size: 1.1em;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    button:hover { background-color: var(--rojo); }

    .card {
      background-color: white;
      border: 1px solid var(--celeste);
      border-radius: 10px;
      padding: 16px;
      margin-top: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .note {
      font-size: 0.95em;
      color: #444;
      margin-top: 8px;
      background: #fff3cd;
      border-left: 4px solid var(--celeste);
      padding: 10px;
      border-radius: 6px;
    }

    #resultDisplay {
      margin-top: 30px;
      font-size: 1.4em;
      font-weight: bold;
      color: var(--morado);
      text-align: center;
    }

    #salaryBreakdown h3 {
      margin-top: 30px;
      color: var(--azul-oscuro);
      font-size: 1.3em;
    }

    #salaryBreakdown ul {
      padding-left: 0;
      list-style: none;
    }

    #salaryBreakdown li { padding: 4px 0; }

    .warning {
      color: var(--rojo);
      font-weight: bold;
      margin-top: 10px;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.6em; }
      input, select { font-size: 1em; padding: 10px; }
      button { font-size: 1em; padding: 12px; }
    }
  </style>
</head>
<body>

  <h1>Calculadora Salarial Docente</h1>
  <p style="text-align: center; font-size: 0.9em; color: #4d3069; margin-top: -20px;">
    Desarrollado por Docentes Brown, seguinos en IG:
    <a href="https://www.instagram.com/docentesbrown" target="_blank" style="color: #3d8fb0; text-decoration: none;">@docentesbrown</a>
  </p>

  <label for="monthSelect">Mes:</label>
  <select id="monthSelect"></select>
  <div id="basicSalaryDisplay" style="margin-top: 8px; font-weight: bold;"></div>

  <label for="positionCount">Cantidad de cargos:</label>
  <input type="number" id="positionCount" min="1" value="1">

  <div class="note">
    Si ten√©s m√≥dulos en diferentes niveles educativos, eleg√≠ tantos cargos como niveles tengas, as√≠ pod√©s calcular cu√°nto cobr√°s por tus m√≥dulos diferenciados por nivel. Por ejemplo: Si trabajas en Secundaria y en Primaria, pon√© 2 cargos y la calculadora te abre un nuevo cuadro para completar.
  </div>

  <label for="globalAntig">Antig√ºedad en a√±os (aplicada a cada cargo):</label>
  <input type="number" id="globalAntig" min="0" placeholder="Ej: 10">

  <div id="cardsContainer"></div>

  <button id="calculateBtn">CALCULAR SALARIO</button>

  <div id="resultDisplay"></div>
  <div id="salaryBreakdown"></div>

  <script>
    const sheetId = '1UVE9egJbF5SnN14h1s7qJPyvYAKcy8rynyOAfNO3jWo';
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

    const basicMap = {};
    let cargosList = new Set();

    const monthSelect = document.getElementById('monthSelect');
    const basicDisplay = document.getElementById('basicSalaryDisplay');
    const positionCount = document.getElementById('positionCount');
    const cardsContainer = document.getElementById('cardsContainer');
    const calculateBtn = document.getElementById('calculateBtn');
    const resultDisplay = document.getElementById('resultDisplay');
    const salaryBreakdown = document.getElementById('salaryBreakdown');
    const globalAntig = document.getElementById('globalAntig');

    const antiguedadMap = {
      0: 0.21, 1: 0.21, 2: 0.24, 3: 0.24, 4: 0.33, 5: 0.33, 6: 0.33,
      7: 0.43, 8: 0.43, 9: 0.43, 10: 0.54, 11: 0.54, 12: 0.64, 13: 0.64,
      14: 0.64, 15: 0.74, 16: 0.74, 17: 0.84, 18: 0.84, 19: 0.84,
      20: 1.05, 21: 1.05, 22: 1.15, 23: 1.15, "mas de 24": 1.24
    };

    const desfavMap = { 0: 0, 1: 0.30, 2: 0.60, 3: 0.90, 4: 1.00, 5: 1.20 };

    const indicesBasico = {
      'Maestro de Grado': 1.1,
      'Maestro de Inicial': 1.1,
      'Preceptor (Inicial)': 1,
      'Preceptor (Sec/Sup)': 1,
      'Profesor M√≥dulos Secundaria': 0.1,
      'Profesor M√≥dulos Inicial': 0.06666666667,
      'Profesor M√≥dulos Primaria': 0.08333333333,
      'Profesor M√≥dulos Superior': 0.125,
      'Bibliotecario Inicial & Primaria': 1.1,
      'Bibliotecario Secundaria & Superior': 1.2,
      'EMATP': 1.2,
      'Maestro Especial': 1.1,
      'Equipo de Orientaci√≥n': 1.1
    };

    fetch(url)
      .then(response => response.text())
      .then(data => {
        const jsonText = data.substring(47).slice(0, -2);
        const jsonData = JSON.parse(jsonText);
        const rows = jsonData.table.rows;

        rows.forEach(row => {
          const cells = row.c;
          if (cells[0] && cells[0].v) {
            const mes = String(cells[0].v).trim();
            const basico = (cells[1] && cells[1].v !== null && cells[1].v !== undefined) ? Number(cells[1].v) : null;

            if (mes && basico !== null && !Number.isNaN(basico)) {
              monthSelect.appendChild(new Option(mes, basico));
              basicMap[mes] = basico;
            }
          }
          if (cells[2] && cells[2].v) cargosList.add(cells[2].v);
        });

        updateCards();

        monthSelect.addEventListener('change', () => {
          const bas = Number(monthSelect.value) || 0;
          basicDisplay.innerText = `Salario b√°sico: $${bas.toFixed(2)}`;
        });

        if (monthSelect.options.length > 0) {
          const basInicial = Number(monthSelect.value) || 0;
          basicDisplay.innerText = `Salario b√°sico: $${basInicial.toFixed(2)}`;
        }
      });

    positionCount.addEventListener('input', updateCards);

    function updateCards() {
      cardsContainer.innerHTML = '';
      const count = parseInt(positionCount.value) || 0;
      for (let i = 0; i < count; i++) {
        const card = document.createElement('div');
        card.className = 'card';

        const labelCargo = document.createElement('label');
        labelCargo.textContent = 'Cargo ' + (i + 1) + ':';
        const selectCargo = document.createElement('select');
        selectCargo.id = 'cargo' + i;
        cargosList.forEach(cargo => selectCargo.appendChild(new Option(cargo, cargo)));

        const labelDesf = document.createElement('label');
        labelDesf.textContent = 'Desfavorabilidad:';
        const selectDesf = document.createElement('select');
        selectDesf.id = 'desf' + i;
        for (let j = 0; j <= 5; j++) selectDesf.appendChild(new Option(j, j));

        const modulosInput = document.createElement('input');
        modulosInput.type = 'number';
        modulosInput.id = 'modulos' + i;
        modulosInput.placeholder = 'Cantidad de m√≥dulos';
        modulosInput.min = 0;

        card.appendChild(labelCargo);
        card.appendChild(selectCargo);
        card.appendChild(labelDesf);
        card.appendChild(selectDesf);
        card.appendChild(modulosInput);

        cardsContainer.appendChild(card);
      }
    }

    calculateBtn.addEventListener('click', () => {
      const basico = Number(monthSelect.value) || 0;
      salaryBreakdown.innerHTML = '';
      let total = 0;
      let breakdownHTML = '<h3>Detalle del sueldo</h3><ul>';

      const antig = globalAntig.value;
      const antigPorcentaje = antiguedadMap[antig] || 0;

      const count = parseInt(positionCount.value) || 0;

      // Topes globales de m√≥dulos (seg√∫n tu c√≥digo actual)
      let totalAdicional455 = 0;
      let totalAdicional667 = 0;
      const maxAdicional455 = 237008;
      const maxAdicional667 = 230059.8;

      for (let i = 0; i < count; i++) {
        const cargo = document.getElementById('cargo' + i).value;
        const desf = parseInt(document.getElementById('desf' + i).value) || 0;
        const modulos = parseInt(document.getElementById('modulos' + i).value) || 0;

        breakdownHTML += `<li><strong>Cargo ${i + 1} - ${cargo}</strong></li>`;

        let subtotal = 0;
        let detalle = '';
        let basicoCargo = basico * (indicesBasico[cargo] || 1);

        if (['Maestro de Grado', 'Maestro de Inicial', 'Bibliotecario Inicial & Primaria'].includes(cargo)) {
          subtotal = basicoCargo + 195114.05 + 118154 + 199147 + 399.56;
          detalle += `
            <li>0110 B√°sico: $${basicoCargo.toFixed(2)}</li>
            <li>0641 Bonificaci√≥n 1¬∫ y 2¬∫ ciclo: $195114.05</li>
            <li>0455 Bonificaci√≥n Docente Agosto 2008: $118154</li>
            <li>0438 Bonificaci√≥n remunerativa: $199147</li>
            <li>2761 Garant√≠a sin aportes: $399.56</li>
          `;
        } else if (['Bibliotecario Secundaria & Superior', 'EMATP'].includes(cargo)) {
          subtotal = basicoCargo + 118154 + 115029.93 + 216955.18 + 450.14;
          detalle += `
            <li>0110 B√°sico: $${basicoCargo.toFixed(2)}</li>
            <li>0455 Bonificaci√≥n Docente Agosto 2008: $118154</li>
            <li>0667 Bonificaci√≥n Hs/Mod. Media: $115029.93</li>
            <li>0451 Suma No Bonificable: $216955.18</li>
            <li>2761 Garant√≠a sin aportes: $450.14</li>
          `;
        } else if (cargo === 'Maestro Especial') {
          subtotal = basicoCargo + 227147.70 + 58243 + 118154 + 199147;
          detalle += `
            <li>0110 B√°sico: $${basicoCargo.toFixed(2)}</li>
            <li>0623 Plus Ense√±anza: $227147.70</li>
            <li>0640 Bonificaci√≥n Funci√≥n Especial: $58243</li>
            <li>0455 Bonif. Docente agosto 2008: $118154</li>
            <li>0438 Bonificaci√≥n remunerativa no bonificante: $199147</li>
          `;
        } else if (cargo === 'Preceptor (Inicial)') {
          subtotal = basicoCargo + 195114.05 + 118154 + 507.54 + 202.55;
          detalle += `
            <li>0110 B√°sico: $${basicoCargo.toFixed(2)}</li>
            <li>0623 Plus Ense√±anza: $195114.05</li>
            <li>0455 Bonif. Docente agosto 2008: $118154</li>
            <li>2761 Garant√≠a Sin aportes: $507.54</li>
            <li>0648 Garant√≠a Con aportes: $202.55</li>
          `;
        } else if (cargo === 'Preceptor (Sec/Sup)') {
          subtotal = basicoCargo + 202.56 + 304756.50 + 118154 + 507.54;
          detalle += `
            <li>0110 B√°sico: $${basicoCargo.toFixed(2)}</li>
            <li>0648 Garant√≠a con aportes 730: $202.56</li>
            <li>0653 Bonificaci√≥n PR: $304756.50</li>
            <li>0455 Bonif. Docente agosto 2008: $118154</li>
            <li>2761 Garant√≠a Sin aportes 930: $507.54</li>
          `;
        } else if (cargo === 'Equipo de Orientaci√≥n') {
          subtotal = basicoCargo + 199147 + 118154 + 215499.1 + 298.43;
          detalle += `
            <li>0110 B√°sico: $${basicoCargo.toFixed(2)}</li>
            <li>0438 Bonf. Remun. 2014: $199147</li>
            <li>0623 Plus de Ense√±anza: $215499.1</li>
            <li>0455 Bonif. Docente agosto 2008: $118154</li>
            <li>2761 Garant√≠a Sin aportes 930: $298.43</li>
          `;
        } else if (cargo.includes('M√≥dulos')) {
          const valorModulo = basicoCargo;
          basicoCargo = valorModulo * modulos;

          const proporcional455 = valorModulo * modulos * 0.4057;
          const proporcional667 = valorModulo * modulos * 0.395;

          const disponible455 = maxAdicional455 - totalAdicional455;
          const disponible667 = maxAdicional667 - totalAdicional667;

          const adicional455 = Math.min(proporcional455, Math.max(0, disponible455));
          const adicional667 = Math.min(proporcional667, Math.max(0, disponible667));

          totalAdicional455 += adicional455;
          totalAdicional667 += adicional667;

          const adicionalDesf = valorModulo * (desfavMap[desf] || 0) * modulos;
          const adicionalAntig = valorModulo * (antiguedadMap[antig] || 0) * modulos;

          subtotal = basicoCargo + adicional667 + adicional455 + adicionalDesf + adicionalAntig;

          detalle += `
            <li>Valor por m√≥dulo: $${valorModulo.toFixed(2)}</li>
            <li>M√≥dulos: ${modulos} √ó $${valorModulo.toFixed(2)} = $${basicoCargo.toFixed(2)}</li>
            <li>667 Bonificaci√≥n No Jer√°rquica (39.5%): $${adicional667.toFixed(2)}</li>
            <li>455 Bonif. Docente agosto 2008 (40.57%): $${adicional455.toFixed(2)}</li>
            <li>Adicional desfavorabilidad: $${adicionalDesf.toFixed(2)}</li>
            <li>Antig√ºedad (${antig} a√±os): $${adicionalAntig.toFixed(2)}</li>
          `;

          if (proporcional455 > disponible455 || proporcional667 > disponible667) {
            detalle += `<li class="warning">¬°ATENCI√ìN! Se aplic√≥ tope m√°ximo global para este cargo</li>`;
          }
        } else {
          subtotal = basicoCargo;
          detalle += `<li>Salario b√°sico ajustado: $${subtotal.toFixed(2)}</li>`;
        }

        if (!cargo.includes('M√≥dulos')) {
          const adicionalDesf = basico * (desfavMap[desf] || 0);
          subtotal += adicionalDesf;
          detalle += `<li>Adicional desfavorabilidad: $${adicionalDesf.toFixed(2)}</li>`;

          const adicionalAntig = basicoCargo * antigPorcentaje;
          subtotal += adicionalAntig;
          detalle += `<li>Antig√ºedad (${antig} a√±os): $${adicionalAntig.toFixed(2)}</li>`;
        }

        breakdownHTML += detalle;
        total += subtotal;
      }

      const descuentoIPS = total * 0.16;
      const descuentoIOMA = total * 0.048;
      const salarioBolsi = total - descuentoIPS - descuentoIOMA;

      breakdownHTML += `
        </ul>
        <h3>Resumen de adicionales para m√≥dulos</h3>
        <ul>
          <li>Total 455 Bonif. Docente: $${totalAdicional455.toFixed(2)} / $${maxAdicional455.toFixed(2)}</li>
          <li>Total 667 Bonif. No Jer√°rquica: $${totalAdicional667.toFixed(2)} / $${maxAdicional667.toFixed(2)}</li>
        </ul>
        <h3>Descuentos</h3>
        <ul>
          <li>IPS (16%): -$${descuentoIPS.toFixed(2)}</li>
          <li>IOMA (4.8%): -$${descuentoIOMA.toFixed(2)}</li>
        </ul>
      `;

      resultDisplay.innerHTML = `
        <div>Salario total estimado: <strong>$${total.toFixed(2)}</strong></div>
        <div>Salario de bolsillo: <strong>$${salarioBolsi.toFixed(2)}</strong></div>
      `;
      salaryBreakdown.innerHTML = breakdownHTML;
    });
  </script>

  <div style="text-align: center; margin-top: 30px;">
    <button onclick="compartirApp()" style="background-color: #3d8fb0; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 1em; cursor: pointer;">
      Compartir esta calculadora
    </button>
  </div>

  <script>
    function compartirApp() {
      if (navigator.share) {
        navigator.share({
          title: 'Calculadora Salarial Docente',
          text: 'Mir√° esta calculadora gratuita para docentes de la Provincia de Buenos Aires.',
          url: window.location.href
        }).catch(() => {});
      } else {
        alert('La funci√≥n de compartir no est√° disponible en este dispositivo. Copi√° el enlace manualmente.');
      }
    }
  </script>

  <div id="visit-counter" style="text-align: center; margin-top: 60px; font-size: 0.95rem; color: #24496e; font-weight: 500;">
    Cargando contador de visitas...
  </div>

  <!-- ‚úÖ CONTADOR ARREGLADO: usa POST para incrementar y fallback a GET si falla -->
  <script>
    // Peg√° ac√° tu URL de Web App (la misma que te da Apps Script al Implementar)
    const VISIT_COUNTER_URL = "https://script.google.com/macros/s/AKfycbyj9hY6xRX6XZzmTIpGPJiyo_WA6z3XiEAstn4Nsb5R4N8u0OvUpUcfZI-tqZqu3Rci7w/exec";

    async function fetchJSON(url, options) {
      const res = await fetch(url, options);
      // Si por alg√∫n motivo vuelve HTML (error/redirect), esto va a explotar y cae al catch
      return await res.json();
    }

    async function cargarContadorVisitas() {
      const el = document.getElementById("visit-counter");
      try {
        // 1) POST -> incrementa y devuelve el nuevo n√∫mero
        const data = await fetchJSON(`${VISIT_COUNTER_URL}?t=${Date.now()}`, {
          method: "POST",
          redirect: "follow",
          // mode:'cors' es default, lo dejamos expl√≠cito para claridad
          mode: "cors",
          cache: "no-store"
        });

        if (data && data.visitas !== undefined) {
          el.innerHTML = `üëÄ <span style="color:#4d3069;">Visitas acumuladas</span>: <strong>${data.visitas}</strong>`;
          return;
        }
        throw new Error("Respuesta sin 'visitas'");
      } catch (err) {
        // 2) Fallback GET -> muestra el n√∫mero aunque no pueda incrementar
        try {
          const data = await fetchJSON(`${VISIT_COUNTER_URL}?t=${Date.now()}`, {
            method: "GET",
            redirect: "follow",
            mode: "cors",
            cache: "no-store"
          });

          if (data && data.visitas !== undefined) {
            el.innerHTML = `üëÄ <span style="color:#4d3069;">Visitas acumuladas</span>: <strong>${data.visitas}</strong>`;
          } else {
            el.innerText = "No se pudo cargar el contador de visitas.";
          }
        } catch (err2) {
          el.innerText = "Error al cargar el contador de visitas.";
        }
      }
    }

    cargarContadorVisitas();
  </script>


<!-- PDF LIBS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<div style="text-align:center;margin-top:20px;">
  <button id="printPDFBtn" style="background:#24496e;">Imprimir Resultados (PDF)</button>
</div>

<script>
  function buildReceiptData() {
    const resumenEl = document.getElementById("resultDisplay");
    const breakdownEl = document.getElementById("salaryBreakdown");

    const resumenLines = [];
    resumenEl.querySelectorAll("div").forEach(d => {
      const t = d.innerText.replace(/\s+/g, " ").trim();
      if (t) resumenLines.push(t);
    });

    const sections = [];
    let current = null;

    Array.from(breakdownEl.children).forEach(node => {
      if (node.tagName === "H3") {
        if (current) sections.push(current);
        current = { title: node.innerText.trim(), items: [] };
      } else if (node.tagName === "UL") {
        const lis = Array.from(node.querySelectorAll("li"));
        lis.forEach(li => {
          const txt = li.innerText.replace(/\s+/g, " ").trim();
          if (txt) {
            if (!current) current = { title: "Detalle", items: [] };
            current.items.push({ text: txt, isWarning: li.classList.contains("warning") });
          }
        });
      }
    });
    if (current) sections.push(current);

    return { resumenLines, sections };
  }

  function makeWatermarkLayer() {
    const wm = document.createElement("div");
    wm.style.position = "absolute";
    wm.style.inset = "0";
    wm.style.opacity = "0.10";
    wm.style.pointerEvents = "none";
    wm.style.zIndex = "0";
    wm.style.display = "grid";
    wm.style.gridTemplateColumns = "repeat(3, 1fr)";
    wm.style.gridAutoRows = "120px";
    wm.style.transform = "rotate(-28deg) scale(1.08)";
    wm.style.transformOrigin = "center";
    for (let i = 0; i < 18; i++) {
      const t = document.createElement("div");
      t.style.display = "flex";
      t.style.alignItems = "center";
      t.style.justifyContent = "center";
      t.style.fontSize = "32px";
      t.style.fontWeight = "700";
      t.style.color = "#4d3069";
      t.innerText = "DOCENTES BROWN";
      wm.appendChild(t);
    }
    return wm;
  }

  function buildReceiptDOM() {
    const data = buildReceiptData();

    const wrap = document.createElement("div");
    wrap.id = "db-pdf-wrap";
    wrap.style.position = "fixed";
    wrap.style.left = "-10000px";
    wrap.style.top = "0";
    wrap.style.width = "794px";
    wrap.style.background = "#ffffff";
    wrap.style.color = "#1c1c1c";
    wrap.style.fontFamily = "Segoe UI, sans-serif";
    wrap.style.padding = "22px";
    wrap.style.boxSizing = "border-box";

    const sheet = document.createElement("div");
    sheet.style.position = "relative";
    sheet.style.border = "2px solid #24496e";
    sheet.style.borderRadius = "12px";
    sheet.style.padding = "18px";
    sheet.style.overflow = "hidden";
    sheet.style.minHeight = "1050px";
    sheet.style.boxSizing = "border-box";
    sheet.appendChild(makeWatermarkLayer());

    const header = document.createElement("div");
    header.style.position = "relative";
    header.style.zIndex = "2";
    header.style.display = "flex";
    header.style.justifyContent = "space-between";
    header.style.alignItems = "flex-start";
    header.style.gap = "14px";

    const left = document.createElement("div");
    left.innerHTML = `
      <div style="font-size:22px;font-weight:800;color:#4d3069;letter-spacing:0.3px;">RECIBO DE SUELDO</div>
      <div style="margin-top:4px;font-size:13px;color:#24496e;font-weight:700;">DOCENTES BROWN</div>
      <div style="margin-top:6px;font-size:12px;color:#444;">
        Documento generado por la calculadora salarial (estimativo).
      </div>
    `;

    const right = document.createElement("div");
    const now = new Date();
    right.innerHTML = `
      <div style="text-align:right;font-size:12px;color:#444;">
        <div><span style="font-weight:700;color:#24496e;">Fecha:</span> ${now.toLocaleDateString()}</div>
        <div style="margin-top:2px;"><span style="font-weight:700;color:#24496e;">Hora:</span> ${now.toLocaleTimeString()}</div>
      </div>
    `;

    header.appendChild(left);
    header.appendChild(right);

    const summaryRow = document.createElement("div");
    summaryRow.style.position = "relative";
    summaryRow.style.zIndex = "2";
    summaryRow.style.display = "grid";
    summaryRow.style.gridTemplateColumns = "1fr 1fr";
    summaryRow.style.gap = "12px";
    summaryRow.style.marginTop = "14px";

    const boxStyle = `
      border: 1.5px solid #3d8fb0;
      border-radius: 10px;
      padding: 12px;
      box-sizing: border-box;
      background: #fbfbfb;
    `;

    const box1 = document.createElement("div");
    box1.style = boxStyle;
    box1.innerHTML = `
      <div style="font-weight:800;color:#24496e;margin-bottom:6px;">RESUMEN</div>
      ${data.resumenLines.map(l => `<div style="font-size:13px;margin:3px 0;">${l}</div>`).join("")}
    `;

    const box2 = document.createElement("div");
    box2.style = boxStyle;
    const basicoTxt = (document.getElementById("basicSalaryDisplay")?.innerText || "").trim();
    const mesSel = document.getElementById("monthSelect");
    const mesTxt = mesSel && mesSel.selectedOptions.length ? mesSel.selectedOptions[0].textContent.trim() : "";
    box2.innerHTML = `
      <div style="font-weight:800;color:#24496e;margin-bottom:6px;">PER√çODO</div>
      <div style="font-size:13px;margin:3px 0;"><span style="font-weight:700;">Mes:</span> ${mesTxt || "-"}</div>
      <div style="font-size:13px;margin:3px 0;">${basicoTxt || ""}</div>
      <div style="font-size:12px;color:#666;margin-top:8px;">
        * Este recibo replica el detalle mostrado en pantalla.
      </div>
    `;

    summaryRow.appendChild(box1);
    summaryRow.appendChild(box2);

    const details = document.createElement("div");
    details.style.position = "relative";
    details.style.zIndex = "2";
    details.style.marginTop = "14px";

    data.sections.forEach(sec => {
      const secBox = document.createElement("div");
      secBox.style.cssText = boxStyle + " margin-top: 12px;";

      const title = document.createElement("div");
      title.style.fontWeight = "900";
      title.style.color = "#4d3069";
      title.style.marginBottom = "8px";
      title.style.fontSize = "14px";
      title.innerText = (sec.title || "").toUpperCase();

      const table = document.createElement("table");
      table.style.width = "100%";
      table.style.borderCollapse = "collapse";
      table.style.fontSize = "12.5px";

      sec.items.forEach(it => {
        const tr = document.createElement("tr");

        const td1 = document.createElement("td");
        td1.style.padding = "6px 6px";
        td1.style.borderTop = "1px solid #e6e6e6";
        td1.style.verticalAlign = "top";
        td1.style.color = it.isWarning ? "#da6863" : "#222";
        td1.style.fontWeight = it.isWarning ? "800" : "400";
        td1.innerText = it.text;

        tr.appendChild(td1);
        table.appendChild(tr);
      });

      secBox.appendChild(title);
      secBox.appendChild(table);
      details.appendChild(secBox);
    });

    const footer = document.createElement("div");
    footer.style.position = "relative";
    footer.style.zIndex = "2";
    footer.style.marginTop = "14px";
    footer.style.borderTop = "1px dashed #3d8fb0";
    footer.style.paddingTop = "10px";
    footer.style.fontSize = "11px";
    footer.style.color = "#555";
    footer.innerHTML = `
      <div><strong style="color:#24496e;">Docentes Brown</strong> ‚Ä¢ Calculadora Salarial Docente ‚Ä¢ @docentesbrown</div>
      <div style="margin-top:4px;">Este PDF es estimativo y no reemplaza el recibo oficial emitido por el empleador.</div>
    `;

    sheet.appendChild(header);
    sheet.appendChild(summaryRow);
    sheet.appendChild(details);
    sheet.appendChild(footer);

    wrap.appendChild(sheet);
    document.body.appendChild(wrap);

    return { wrap, sheet };
  }

  async function exportReceiptPDF() {
    const breakdownText = (document.getElementById("salaryBreakdown")?.innerText || "").trim();
    if (!breakdownText) {
      alert("Primero calcul√° el salario para poder imprimir el recibo.");
      return;
    }

    const { jsPDF } = window.jspdf;

    const { wrap, sheet } = buildReceiptDOM();

    const canvas = await html2canvas(sheet, { scale: 2, useCORS: true, backgroundColor: "#ffffff" });

    const imgData = canvas.toDataURL("image/png");
    const pdf = new jsPDF("p", "mm", "a4");

    const pageWidth = pdf.internal.pageSize.getWidth();
    const pageHeight = pdf.internal.pageSize.getHeight();

    const imgWidth = pageWidth;
    const imgHeight = canvas.height * imgWidth / canvas.width;

    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;

    while (heightLeft > 0) {
      position = heightLeft - imgHeight;
      pdf.addPage();
      pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
    }

    pdf.save("recibo_docentes_brown.pdf");

    document.body.removeChild(wrap);
  }

  document.getElementById("printPDFBtn").addEventListener("click", exportReceiptPDF);
</script>

</body>
</html>
